
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://pasqal-io.github.io/qadence/v1.7.0/api/ml_tools/">
      
      
        <link rel="prev" href="../models/">
      
      
        <link rel="next" href="../serialization/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>QML tools - Qadence</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_markdown_exec_pyodide.css">
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../extras/css/mkdocstrings.css">
    
      <link rel="stylesheet" href="../../extras/css/colors.css">
    
      <link rel="stylesheet" href="../../extras/css/home.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ml-tools" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Qadence" class="md-header__button md-logo" aria-label="Qadence" data-md-component="logo">
      
  <img src="../../extras/assets/logo/qadence_logo_small_white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Qadence
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              QML tools
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/pasqal-io/qadence/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    qadence
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting_started/installation/" class="md-tabs__link">
          
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../content/block_system/" class="md-tabs__link">
          
  
    
  
  Contents

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../tutorials/" class="md-tabs__link">
        
  
    
  
  Tutorials

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../blocks/" class="md-tabs__link">
          
  
    
  
  API

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Qadence" class="md-nav__button md-logo" aria-label="Qadence" data-md-component="logo">
      
  <img src="../../extras/assets/logo/qadence_logo_small_white.svg" alt="logo">

    </a>
    Qadence
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pasqal-io/qadence/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    qadence
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Development & Info
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Development & Info
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/CONTRIBUTING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/CODE_OF_CONDUCT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code of conduct
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/LICENSE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contents
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Contents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../content/block_system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Block system
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../content/parameters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parametric programs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../content/quantummodels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quantum models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../content/register/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quantum registers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../content/state_init/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State initialization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../content/hamiltonians/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arbitrary Hamiltonians
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../content/qml_constructors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    QML Constructors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../content/overlap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wavefunction overlaps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../content/backends/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backends
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
        
          
          <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Useful info
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            Useful info
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../content/state_conventions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State conventions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../content/serializ_and_prep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serialization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorials/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorials/digital_analog_qc/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Digital-analog quantum computing
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Digital-analog quantum computing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/digital_analog_qc/analog-basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic operations on neutral-atoms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/digital_analog_qc/analog-qcl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fitting a simple function
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/digital_analog_qc/semi-local-addressing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Restricted local addressability
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/digital_analog_qc/pulser-basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pulse-level programming with Pulser
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/digital_analog_qc/analog-qubo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solve a QUBO problem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/digital_analog_qc/daqc-cnot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CNOT with interacting qubits
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorials/qml/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Variational quantum algorithms
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Variational quantum algorithms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/qml/ml_tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/qml/config_qnn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuring a QNN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/qml/qcl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quantum circuit learning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/qml/qaoa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solving MaxCut with QAOA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/qml/dqc_1d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solving a 1D ODE
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorials/advanced_tutorials/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Advanced Tutorials
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Advanced Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/advanced_tutorials/differentiability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quantum circuits differentiation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/advanced_tutorials/custom-models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom quantum models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/advanced_tutorials/projectors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Projector blocks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/advanced_tutorials/profiling-and-debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profiling and debugging on CUDA devices
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorials/realistic_sims/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Realistic simulations
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Realistic simulations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/realistic_sims/measurements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Measurement protocols
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/realistic_sims/noise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simulated errors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/realistic_sims/mitigation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Error mitigation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/development/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture and sharp bits
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/development/draw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Drawing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blocks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Block system
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Operations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../register/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Register
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quantumcircuit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    QuantumCircuit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parameters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../states/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State preparation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../constructors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Constructors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transpile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transpilation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Execution
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quantum models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    QML tools
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    QML tools
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ml-tools" class="md-nav__link">
    <span class="md-ellipsis">
      ML Tools
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ML Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.AnsatzConfig" class="md-nav__link">
    <span class="md-ellipsis">
      AnsatzConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AnsatzConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.AnsatzConfig.ansatz_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      ansatz_strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.AnsatzConfig.ansatz_type" class="md-nav__link">
    <span class="md-ellipsis">
      ansatz_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.AnsatzConfig.depth" class="md-nav__link">
    <span class="md-ellipsis">
      depth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.AnsatzConfig.param_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      param_prefix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.AnsatzConfig.strategy_args" class="md-nav__link">
    <span class="md-ellipsis">
      strategy_args
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig" class="md-nav__link">
    <span class="md-ellipsis">
      FeatureMapConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FeatureMapConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.basis_set" class="md-nav__link">
    <span class="md-ellipsis">
      basis_set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.feature_map_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      feature_map_strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.feature_range" class="md-nav__link">
    <span class="md-ellipsis">
      feature_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.inputs" class="md-nav__link">
    <span class="md-ellipsis">
      inputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.multivariate_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      multivariate_strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.num_features" class="md-nav__link">
    <span class="md-ellipsis">
      num_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.num_repeats" class="md-nav__link">
    <span class="md-ellipsis">
      num_repeats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.operation" class="md-nav__link">
    <span class="md-ellipsis">
      operation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.param_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      param_prefix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.reupload_scaling" class="md-nav__link">
    <span class="md-ellipsis">
      reupload_scaling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.target_range" class="md-nav__link">
    <span class="md-ellipsis">
      target_range
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TrainConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TrainConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.batch_size" class="md-nav__link">
    <span class="md-ellipsis">
      batch_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.checkpoint_best_only" class="md-nav__link">
    <span class="md-ellipsis">
      checkpoint_best_only
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.checkpoint_every" class="md-nav__link">
    <span class="md-ellipsis">
      checkpoint_every
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.create_subfolder_per_run" class="md-nav__link">
    <span class="md-ellipsis">
      create_subfolder_per_run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.folder" class="md-nav__link">
    <span class="md-ellipsis">
      folder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.max_iter" class="md-nav__link">
    <span class="md-ellipsis">
      max_iter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.print_every" class="md-nav__link">
    <span class="md-ellipsis">
      print_every
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.trainstop_criterion" class="md-nav__link">
    <span class="md-ellipsis">
      trainstop_criterion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.val_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      val_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.val_every" class="md-nav__link">
    <span class="md-ellipsis">
      val_every
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.validation_criterion" class="md-nav__link">
    <span class="md-ellipsis">
      validation_criterion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.verbose" class="md-nav__link">
    <span class="md-ellipsis">
      verbose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.write_every" class="md-nav__link">
    <span class="md-ellipsis">
      write_every
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.parameters.get_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      get_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.parameters.num_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      num_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.parameters.set_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      set_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.optimize_step.optimize_step" class="md-nav__link">
    <span class="md-ellipsis">
      optimize_step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.train_grad.train" class="md-nav__link">
    <span class="md-ellipsis">
      train
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.train_no_grad.train" class="md-nav__link">
    <span class="md-ellipsis">
      train
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.data.DictDataLoader" class="md-nav__link">
    <span class="md-ellipsis">
      DictDataLoader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.data.InfiniteTensorDataset" class="md-nav__link">
    <span class="md-ellipsis">
      InfiniteTensorDataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.data.data_to_device" class="md-nav__link">
    <span class="md-ellipsis">
      data_to_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.data.to_dataloader" class="md-nav__link">
    <span class="md-ellipsis">
      to_dataloader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.models.QNN" class="md-nav__link">
    <span class="md-ellipsis">
      QNN
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QNN">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.models.QNN.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.models.QNN.from_configs" class="md-nav__link">
    <span class="md-ellipsis">
      from_configs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.models.derivative" class="md-nav__link">
    <span class="md-ellipsis">
      derivative
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.models.format_to_dict_fn" class="md-nav__link">
    <span class="md-ellipsis">
      format_to_dict_fn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../serialization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serialization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../draw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Drawing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_15" >
        
          
          <label class="md-nav__link" for="__nav_5_15" id="__nav_5_15_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Backends
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_15">
            <span class="md-nav__icon md-icon"></span>
            Backends
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backends/backend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abstract backend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backends/pyqtorch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyQTorch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backends/pulser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pulser
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backends/differentiable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DifferentiableBackend
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ml-tools" class="md-nav__link">
    <span class="md-ellipsis">
      ML Tools
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ML Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.AnsatzConfig" class="md-nav__link">
    <span class="md-ellipsis">
      AnsatzConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AnsatzConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.AnsatzConfig.ansatz_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      ansatz_strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.AnsatzConfig.ansatz_type" class="md-nav__link">
    <span class="md-ellipsis">
      ansatz_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.AnsatzConfig.depth" class="md-nav__link">
    <span class="md-ellipsis">
      depth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.AnsatzConfig.param_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      param_prefix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.AnsatzConfig.strategy_args" class="md-nav__link">
    <span class="md-ellipsis">
      strategy_args
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig" class="md-nav__link">
    <span class="md-ellipsis">
      FeatureMapConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FeatureMapConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.basis_set" class="md-nav__link">
    <span class="md-ellipsis">
      basis_set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.feature_map_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      feature_map_strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.feature_range" class="md-nav__link">
    <span class="md-ellipsis">
      feature_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.inputs" class="md-nav__link">
    <span class="md-ellipsis">
      inputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.multivariate_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      multivariate_strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.num_features" class="md-nav__link">
    <span class="md-ellipsis">
      num_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.num_repeats" class="md-nav__link">
    <span class="md-ellipsis">
      num_repeats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.operation" class="md-nav__link">
    <span class="md-ellipsis">
      operation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.param_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      param_prefix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.reupload_scaling" class="md-nav__link">
    <span class="md-ellipsis">
      reupload_scaling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.FeatureMapConfig.target_range" class="md-nav__link">
    <span class="md-ellipsis">
      target_range
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TrainConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TrainConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.batch_size" class="md-nav__link">
    <span class="md-ellipsis">
      batch_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.checkpoint_best_only" class="md-nav__link">
    <span class="md-ellipsis">
      checkpoint_best_only
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.checkpoint_every" class="md-nav__link">
    <span class="md-ellipsis">
      checkpoint_every
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.create_subfolder_per_run" class="md-nav__link">
    <span class="md-ellipsis">
      create_subfolder_per_run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.folder" class="md-nav__link">
    <span class="md-ellipsis">
      folder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.max_iter" class="md-nav__link">
    <span class="md-ellipsis">
      max_iter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.print_every" class="md-nav__link">
    <span class="md-ellipsis">
      print_every
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.trainstop_criterion" class="md-nav__link">
    <span class="md-ellipsis">
      trainstop_criterion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.val_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      val_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.val_every" class="md-nav__link">
    <span class="md-ellipsis">
      val_every
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.validation_criterion" class="md-nav__link">
    <span class="md-ellipsis">
      validation_criterion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.verbose" class="md-nav__link">
    <span class="md-ellipsis">
      verbose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.config.TrainConfig.write_every" class="md-nav__link">
    <span class="md-ellipsis">
      write_every
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.parameters.get_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      get_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.parameters.num_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      num_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.parameters.set_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      set_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.optimize_step.optimize_step" class="md-nav__link">
    <span class="md-ellipsis">
      optimize_step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.train_grad.train" class="md-nav__link">
    <span class="md-ellipsis">
      train
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.train_no_grad.train" class="md-nav__link">
    <span class="md-ellipsis">
      train
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.data.DictDataLoader" class="md-nav__link">
    <span class="md-ellipsis">
      DictDataLoader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.data.InfiniteTensorDataset" class="md-nav__link">
    <span class="md-ellipsis">
      InfiniteTensorDataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.data.data_to_device" class="md-nav__link">
    <span class="md-ellipsis">
      data_to_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.data.to_dataloader" class="md-nav__link">
    <span class="md-ellipsis">
      to_dataloader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.models.QNN" class="md-nav__link">
    <span class="md-ellipsis">
      QNN
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QNN">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.models.QNN.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.models.QNN.from_configs" class="md-nav__link">
    <span class="md-ellipsis">
      from_configs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.models.derivative" class="md-nav__link">
    <span class="md-ellipsis">
      derivative
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qadence.ml_tools.models.format_to_dict_fn" class="md-nav__link">
    <span class="md-ellipsis">
      format_to_dict_fn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>QML tools</h1>

<h2 id="ml-tools">ML Tools</h2>
<p>This module implements gradient-free and gradient-based training loops for torch Modules and QuantumModel. It also implements the QNN class.</p>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="qadence.ml_tools.config.AnsatzConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">AnsatzConfig</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ansatz_type</span><span class="o">=</span><span class="n">AnsatzType</span><span class="o">.</span><span class="n">HEA</span><span class="p">,</span> <span class="n">ansatz_strategy</span><span class="o">=</span><span class="n">Strategy</span><span class="o">.</span><span class="n">DIGITAL</span><span class="p">,</span> <span class="n">strategy_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">param_prefix</span><span class="o">=</span><span class="s1">&#39;theta&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">





  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.AnsatzConfig.ansatz_strategy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ansatz_strategy</span><span class="p">:</span> <span class="n">Strategy</span> <span class="o">=</span> <span class="n">Strategy</span><span class="o">.</span><span class="n">DIGITAL</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Ansatz strategy.</p>
<p>DIGITAL for fully digital ansatz. Required if <code>ansatz_type</code> is <code>iia</code>.
SDAQC for analog entangling block.
RYDBERG for fully rydberg hea ansatz.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.AnsatzConfig.ansatz_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ansatz_type</span><span class="p">:</span> <span class="n">AnsatzType</span> <span class="o">=</span> <span class="n">AnsatzType</span><span class="o">.</span><span class="n">HEA</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>What type of ansatz.</p>
<p>HEA for Hardware Efficient Ansatz.
IIA for Identity intialized Ansatz.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.AnsatzConfig.depth" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Number of layers of the ansatz.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.AnsatzConfig.param_prefix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">param_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;theta&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>The base bame of the variational parameter.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.AnsatzConfig.strategy_args" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">strategy_args</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>A dictionary containing keyword arguments to the function creating the ansatz.</p>
<p>Details about each below.</p>
<p>For DIGITAL strategy, accepts the following:
    periodic (bool): if the qubits should be linked periodically.
        periodic=False is not supported in emu-c.
    operations (list): list of operations to cycle through in the
        digital single-qubit rotations of each layer.
        Defaults to  [RX, RY, RX] for hea and [RX, RY] for iia.
    entangler (AbstractBlock): 2-qubit entangling operation.
        Supports CNOT, CZ, CRX, CRY, CRZ, CPHASE. Controlld rotations
        will have variational parameters on the rotation angles.
        Defaults to CNOT</p>
<p>For SDAQC strategy, accepts the following:
    operations (list): list of operations to cycle through in the
        digital single-qubit rotations of each layer.
        Defaults to  [RX, RY, RX] for hea and [RX, RY] for iia.
    entangler (AbstractBlock): Hamiltonian generator for the
        analog entangling layer. Time parameter is considered variational.
        Defaults to NN interaction.</p>
<p>For RYDBERG strategy, accepts the following:
    addressable_detuning: whether to turn on the trainable semi-local addressing pattern
        on the detuning (n_i terms in the Hamiltonian).
        Defaults to True.
    addressable_drive: whether to turn on the trainable semi-local addressing pattern
        on the drive (sigma_i^x terms in the Hamiltonian).
        Defaults to False.
    tunable_phase: whether to have a tunable phase to get both sigma^x and sigma^y rotations
        in the drive term. If False, only a sigma^x term will be included in the drive part
        of the Hamiltonian generator.
        Defaults to False.</p>
    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="qadence.ml_tools.config.FeatureMapConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">FeatureMapConfig</span><span class="p">(</span><span class="n">num_features</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="n">BasisSet</span><span class="o">.</span><span class="n">FOURIER</span><span class="p">,</span> <span class="n">reupload_scaling</span><span class="o">=</span><span class="n">ReuploadScaling</span><span class="o">.</span><span class="n">CONSTANT</span><span class="p">,</span> <span class="n">feature_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multivariate_strategy</span><span class="o">=</span><span class="n">MultivariateStrategy</span><span class="o">.</span><span class="n">PARALLEL</span><span class="p">,</span> <span class="n">feature_map_strategy</span><span class="o">=</span><span class="n">Strategy</span><span class="o">.</span><span class="n">DIGITAL</span><span class="p">,</span> <span class="n">param_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_repeats</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">





  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.FeatureMapConfig.basis_set" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">basis_set</span><span class="p">:</span> <span class="n">BasisSet</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BasisSet</span><span class="p">]</span> <span class="o">=</span> <span class="n">BasisSet</span><span class="o">.</span><span class="n">FOURIER</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Basis set for feature encoding.</p>
<p>Takes qadence.BasisSet.
Give a single BasisSet to use the same for all features.
Give a dict of (str, BasisSet) where the key is the name of the variable and the
value is the BasisSet to use for encoding that feature.
BasisSet.FOURIER for Fourier encoding.
BasisSet.CHEBYSHEV for Chebyshev encoding.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.FeatureMapConfig.feature_map_strategy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">feature_map_strategy</span><span class="p">:</span> <span class="n">Strategy</span> <span class="o">=</span> <span class="n">Strategy</span><span class="o">.</span><span class="n">DIGITAL</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Strategy for feature map.</p>
<p>Accepts DIGITAL, ANALOG or RYDBERG. Defaults to DIGITAL.
If the strategy is incompatible with the <code>operation</code> chosen, then <code>operation</code>
gets preference and the given strategy is ignored.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.FeatureMapConfig.feature_range" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">feature_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Range of data that the input data is assumed to come from.</p>
<p>Give a single tuple to use the same range for all features.
Give a dict of (str, tuple) where the key is the name of the variable and the
value is the feature range to use for that feature.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.FeatureMapConfig.inputs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Basic</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>List that indicates the order of variables of the tensors that are passed.</p>
<p>Optional if a single feature is being encoded, required otherwise. Given input tensors
<code>xs = torch.rand(batch_size, input_size:=2)</code> a QNN with <code>inputs=["t", "x"]</code> will
assign <code>t, x = xs[:,0], xs[:,1]</code>.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.FeatureMapConfig.multivariate_strategy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multivariate_strategy</span><span class="p">:</span> <span class="n">MultivariateStrategy</span> <span class="o">=</span> <span class="n">MultivariateStrategy</span><span class="o">.</span><span class="n">PARALLEL</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>The  encoding strategy in case of multi-variate function.</p>
<p>Takes qadence.MultivariateStrategy.
If PARALLEL, the features are encoded in one block of rotation gates
with each feature given an equal number of qubits.
If SERIES, the features are encoded sequentially, with an ansatz block
between. PARALLEL is allowed only for DIGITAL <code>feature_map_strategy</code>.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.FeatureMapConfig.num_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Number of feature parameters to be encoded.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.FeatureMapConfig.num_repeats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_repeats</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Number of feature map layers repeated in the data reuploadig step.</p>
<p>If all are to be repeated the same number of times, then can give a single
<code>int</code>. For different number of repeatitions for each feature, provide a dict
of (str, int) where the key is the name of the variable and the value is the
number of repeatitions for that feature.
This amounts to the number of additional reuploads. So if <code>num_repeats</code> is N,
the data gets uploaded N+1 times. Defaults to no repeatition.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.FeatureMapConfig.operation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">operation</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Parameter</span> <span class="o">|</span> <span class="n">Basic</span><span class="p">],</span> <span class="n">AnalogBlock</span><span class="p">]</span> <span class="o">|</span> <span class="n">Type</span><span class="p">[</span><span class="n">RX</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Type of operation.</p>
<p>Choose among the analog or digital rotations or a custom
callable function returning an AnalogBlock instance. If the type of operation is
incompatible with the <code>strategy</code> chosen, then <code>operation</code> gets preference and
the given strategy is ignored.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.FeatureMapConfig.param_prefix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">param_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>String prefix to create trainable parameters in Feature Map.</p>
<p>A string prefix to create trainable parameters multiplying the feature parameter
inside the feature-encoding function. Note that currently this does not take into
account the domain of the feature-encoding function.
Defaults to <code>None</code> and thus, the feature map is not trainable.
Note that this is separate from the name of the parameter.
The user can provide a single prefix for all features, and they will be appended
by appropriate feature name automatically.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.FeatureMapConfig.reupload_scaling" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reupload_scaling</span><span class="p">:</span> <span class="n">ReuploadScaling</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ReuploadScaling</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReuploadScaling</span><span class="o">.</span><span class="n">CONSTANT</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Scaling for encoding the same feature on different qubits.</p>
<p>Scaling used to encode the same feature on different qubits in the
same layer of the feature maps. Takes qadence.ReuploadScaling.
Give a single ReuploadScaling to use the same for all features.
Give a dict of (str, ReuploadScaling) where the key is the name of the variable and the
value is the ReuploadScaling to use for encoding that feature.
ReuploadScaling.CONSTANT for constant scaling.
ReuploadScaling.TOWER for linearly increasing scaling.
ReuploadScaling.EXP for exponentially increasing scaling.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.FeatureMapConfig.target_range" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">target_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Range of data the data encoder assumes as natural range.</p>
<p>Give a single tuple to use the same range for all features.
Give a dict of (str, tuple) where the key is the name of the variable and the
value is the target range to use for that feature.</p>
    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="qadence.ml_tools.config.TrainConfig" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">TrainConfig</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">print_every</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">write_every</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">checkpoint_every</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_subfolder_per_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">checkpoint_best_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val_every</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">val_epsilon</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">validation_criterion</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trainstop_criterion</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">


      <p>Default config for the train function.</p>
<p>The default value of
each field can be customized with the constructor:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">qadence.ml_tools</span> <span class="kn">import</span> <span class="n">TrainConfig</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">c</span> <span class="o">=</span> <span class="n">TrainConfig</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="s2">&quot;/tmp/train&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="result" markdown="1" >

<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="err">Trai</span><span class="kc">n</span><span class="err">Co</span><span class="kc">nf</span><span class="err">ig(max_i</span><span class="kc">ter</span><span class="err">=</span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="err">pri</span><span class="kc">nt</span><span class="err">_every=</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="err">wri</span><span class="kc">te</span><span class="err">_every=</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="err">checkpoi</span><span class="kc">nt</span><span class="err">_every=</span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="kc">f</span><span class="err">older=PosixPa</span><span class="kc">t</span><span class="err">h(&#39;/</span><span class="kc">t</span><span class="err">mp/</span><span class="kc">tra</span><span class="err">i</span><span class="kc">n</span><span class="err">&#39;)</span><span class="p">,</span><span class="w"> </span><span class="err">crea</span><span class="kc">te</span><span class="err">_sub</span><span class="kc">f</span><span class="err">older_per_ru</span><span class="kc">n</span><span class="err">=False</span><span class="p">,</span><span class="w"> </span><span class="err">checkpoi</span><span class="kc">nt</span><span class="err">_bes</span><span class="kc">t</span><span class="err">_o</span><span class="kc">nl</span><span class="err">y=False</span><span class="p">,</span><span class="w"> </span><span class="err">val_every=No</span><span class="kc">ne</span><span class="p">,</span><span class="w"> </span><span class="err">val_epsilo</span><span class="kc">n</span><span class="err">=</span><span class="mf">1e-05</span><span class="p">,</span><span class="w"> </span><span class="err">valida</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">_cri</span><span class="kc">ter</span><span class="err">io</span><span class="kc">n</span><span class="err">=&lt;</span><span class="kc">fun</span><span class="err">c</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">Trai</span><span class="kc">n</span><span class="err">Co</span><span class="kc">nf</span><span class="err">ig.__pos</span><span class="kc">t</span><span class="err">_i</span><span class="kc">n</span><span class="err">i</span><span class="kc">t</span><span class="err">__.&lt;locals&gt;.&lt;lambda&gt;</span><span class="w"> </span><span class="err">a</span><span class="kc">t</span><span class="w"> </span><span class="mi">0</span><span class="err">x</span><span class="mi">7</span><span class="kc">f</span><span class="mi">92786</span><span class="kc">f</span><span class="mi">4</span><span class="err">a</span><span class="kc">f</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">,</span><span class="w"> </span><span class="kc">tra</span><span class="err">i</span><span class="kc">nst</span><span class="err">op_cri</span><span class="kc">ter</span><span class="err">io</span><span class="kc">n</span><span class="err">=&lt;</span><span class="kc">fun</span><span class="err">c</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">Trai</span><span class="kc">n</span><span class="err">Co</span><span class="kc">nf</span><span class="err">ig.__pos</span><span class="kc">t</span><span class="err">_i</span><span class="kc">n</span><span class="err">i</span><span class="kc">t</span><span class="err">__.&lt;locals&gt;.&lt;lambda&gt;</span><span class="w"> </span><span class="err">a</span><span class="kc">t</span><span class="w"> </span><span class="mi">0</span><span class="err">x</span><span class="mi">7</span><span class="kc">f</span><span class="mi">92786</span><span class="kc">f</span><span class="mf">60e0</span><span class="err">&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">ba</span><span class="kc">t</span><span class="err">ch_size=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">verbose=True)</span>
</code></pre></div>

</div>




  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.TrainConfig.batch_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>The batch_size to use when passing a list/tuple of torch.Tensors.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.TrainConfig.checkpoint_best_only" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">checkpoint_best_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Write model/optimizer checkpoint only if a metric has improved.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.TrainConfig.checkpoint_every" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">checkpoint_every</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5000</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Write model/optimizer checkpoint.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.TrainConfig.create_subfolder_per_run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_subfolder_per_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Checkpoint/tensorboard logs stored in subfolder with name <code>&lt;timestamp&gt;_&lt;PID&gt;</code>.</p>
<p>Prevents continuing from previous checkpoint, useful for fast prototyping.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.TrainConfig.folder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Checkpoint/tensorboard logs folder.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.TrainConfig.max_iter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Number of training iterations.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.TrainConfig.print_every" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">print_every</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Print loss/metrics.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.TrainConfig.trainstop_criterion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">trainstop_criterion</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>A boolean function which evaluates a given training stopping metric is satisfied.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.TrainConfig.val_epsilon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">val_epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-05</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Safety margin to check if validation loss is smaller than the lowest.</p>
<p>validation loss across previous iterations.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.TrainConfig.val_every" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">val_every</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Calculate validation metric.</p>
<p>If None, validation check is not performed.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.TrainConfig.validation_criterion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validation_criterion</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>A boolean function which evaluates a given validation metric is satisfied.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.TrainConfig.verbose" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Whether or not to print out metrics values during training.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="qadence.ml_tools.config.TrainConfig.write_every" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_every</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Write tensorboard logs.</p>
    </div>

</div>





  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="qadence.ml_tools.parameters.get_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Retrieve all trainable model parameters in a single vector.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>model</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the input PyTorch model</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.nn.Module">Module</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>Tensor</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a 1-dimensional tensor with the parameters</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.Tensor">Tensor</span></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>qadence/ml_tools/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="k">def</span> <span class="nf">get_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">Module</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve all trainable model parameters in a single vector.</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">        model (Module): the input PyTorch model</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        Tensor: a 1-dimensional tensor with the parameters</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">requires_grad</span><span class="p">]</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="qadence.ml_tools.parameters.num_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return the total number of parameters of the given model.</p>

            <details class="quote">
              <summary>Source code in <code>qadence/ml_tools/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="k">def</span> <span class="nf">num_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">Module</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the total number of parameters of the given model.&quot;&quot;&quot;</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">get_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="qadence.ml_tools.parameters.set_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Set all trainable parameters of a model from a single vector.</p>
<p>Notice that this function assumes prior knowledge of right number
of parameters in the model</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>model</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the input PyTorch model</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.nn.Module">Module</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>theta</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the parameters to assign</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.Tensor">Tensor</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>qadence/ml_tools/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="k">def</span> <span class="nf">set_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set all trainable parameters of a model from a single vector.</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    Notice that this function assumes prior knowledge of right number</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    of parameters in the model</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        model (Module): the input PyTorch model</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        theta (Tensor): the parameters to assign</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="k">for</span> <span class="n">ps</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>            <span class="k">if</span> <span class="n">ps</span><span class="o">.</span><span class="n">requires_grad</span><span class="p">:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">numel</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>                <span class="k">if</span> <span class="n">ps</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>                    <span class="n">ps</span><span class="p">[()]</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="n">idx</span> <span class="p">:</span> <span class="n">idx</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>                    <span class="n">ps</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="n">idx</span> <span class="p">:</span> <span class="n">idx</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="qadence.ml_tools.optimize_step.optimize_step" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">optimize_step</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">loss_fn</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Default Torch optimize step with closure.</p>
<p>This is the default optimization step which should work for most
of the standard use cases of optimization of Torch models</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>model</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The input model</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.nn.Module">Module</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>optimizer</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The chosen Torch optimizer</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.optim.Optimizer">Optimizer</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>loss_fn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A custom loss function</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Callable">Callable</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>xs</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the input data. If None it means
that the given model does not require any input data</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict | list | <span title="torch.Tensor">Tensor</span> | None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>device</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A target device to run computation on.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.device">device</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tuple</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>tuple containing the model, the optimizer, a dictionary with
the collected metrics and the compute value loss</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code>tuple[<span title="torch.Tensor">Tensor</span> | float, dict | None]</code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>qadence/ml_tools/optimize_step.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="k">def</span> <span class="nf">optimize_step</span><span class="p">(</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="n">model</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="n">optimizer</span><span class="p">:</span> <span class="n">Optimizer</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="n">loss_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="n">xs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Default Torch optimize step with closure.</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    This is the default optimization step which should work for most</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    of the standard use cases of optimization of Torch models</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        model (Module): The input model</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        optimizer (Optimizer): The chosen Torch optimizer</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        loss_fn (Callable): A custom loss function</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        xs (dict | list | torch.Tensor | None): the input data. If None it means</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">            that the given model does not require any input data</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        device (torch.device): A target device to run computation on.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        tuple: tuple containing the model, the optimizer, a dictionary with</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            the collected metrics and the compute value loss</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{}</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">xs_to_device</span> <span class="o">=</span> <span class="n">data_to_device</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="k">def</span> <span class="nf">closure</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="c1"># NOTE: We need the nonlocal as we can&#39;t return a metric dict and</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="c1"># because e.g. LBFGS calls this closure multiple times but for some</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="c1"># reason the returned loss is always the first one...</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="k">nonlocal</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">loss</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">xs_to_device</span><span class="p">)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">retain_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="k">return</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">closure</span><span class="p">)</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="c1"># return the loss/metrics that are being mutated inside the closure...</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="qadence.ml_tools.train_grad.train" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataloader</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">loss_fn</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optimize_step</span><span class="o">=</span><span class="n">optimize_step</span><span class="p">,</span> <span class="n">write_tensorboard</span><span class="o">=</span><span class="n">write_tensorboard</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Runs the training loop with gradient-based optimizer.</p>
<p>Assumes that <code>loss_fn</code> returns a tuple of (loss,
metrics: dict), where <code>metrics</code> is a dict of scalars. Loss and metrics are
written to tensorboard. Checkpoints are written every
<code>config.checkpoint_every</code> steps (and after the last training step).  If a
checkpoint is found at <code>config.folder</code> we resume training from there.  The
tensorboard logs can be viewed via <code>tensorboard --logdir /path/to/folder</code>.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>model</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The model to train.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.nn.Module">Module</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dataloader</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>dataloader of different types. If None, no data is required by
the model</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[None, <span title="torch.utils.data.DataLoader">DataLoader</span>, <a class="autorefs autorefs-internal" title="qadence.ml_tools.data.DictDataLoader" href="#qadence.ml_tools.data.DictDataLoader">DictDataLoader</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>optimizer</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The optimizer to use.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.optim.Optimizer">Optimizer</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>config</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p><code>TrainConfig</code> with additional training options.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="qadence.ml_tools.config.TrainConfig" href="#qadence.ml_tools.config.TrainConfig">TrainConfig</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>loss_fn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loss function returning (loss: float, metrics: dict[str, float])</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Callable">Callable</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>device</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String defining device to train on, pass 'cuda' for GPU.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.device">device</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>optimize_step</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Customizable optimization callback which is called at every iteration.=
The function must have the signature <code>optimize_step(model,
optimizer, loss_fn, xs, device="cpu")</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Callable">Callable</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><a class="autorefs autorefs-internal" title="qadence.ml_tools.optimize_step.optimize_step" href="#qadence.ml_tools.optimize_step.optimize_step">optimize_step</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>write_tensorboard</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Customizable tensorboard logging callback which is
called every <code>config.write_every</code> iterations. The function must have
the signature <code>write_tensorboard(writer, loss, metrics, iteration)</code>
(see the example below).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Callable">Callable</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="qadence.ml_tools.printing.write_tensorboard">write_tensorboard</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dtype</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The dtype to use for the data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.dtype">dtype</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span> <span class="nn">torch</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">count</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span> <span class="nn">qadence</span> <span class="kn">import</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">Z</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">from</span> <span class="nn">qadence</span> <span class="kn">import</span> <span class="n">hamiltonian_factory</span><span class="p">,</span> <span class="n">hea</span><span class="p">,</span> <span class="n">feature_map</span><span class="p">,</span> <span class="n">chain</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="kn">from</span> <span class="nn">qadence</span> <span class="kn">import</span> <span class="n">QNN</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="kn">from</span> <span class="nn">qadence.ml_tools</span> <span class="kn">import</span> <span class="n">TrainConfig</span><span class="p">,</span> <span class="n">train_with_grad</span><span class="p">,</span> <span class="n">to_dataloader</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">n_qubits</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="n">fm</span> <span class="o">=</span> <span class="n">feature_map</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">ansatz</span> <span class="o">=</span> <span class="n">hea</span><span class="p">(</span><span class="n">n_qubits</span><span class="o">=</span><span class="n">n_qubits</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">observable</span> <span class="o">=</span> <span class="n">hamiltonian_factory</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">,</span> <span class="n">detuning</span> <span class="o">=</span> <span class="n">Z</span><span class="p">)</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">,</span> <span class="n">fm</span><span class="p">,</span> <span class="n">ansatz</span><span class="p">)</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="n">model</span> <span class="o">=</span> <span class="n">QNN</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">observable</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;pyqtorch&quot;</span><span class="p">,</span> <span class="n">diff_mode</span><span class="o">=</span><span class="s2">&quot;ad&quot;</span><span class="p">)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="n">input_values</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;phi&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)}</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_values</span><span class="p">)</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="c1">## lets prepare the train routine</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="n">cnt</span> <span class="o">=</span> <span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>    <span class="nb">next</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>    <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="p">{}</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="n">tmp_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tmp&quot;</span><span class="p">)</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">25</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="n">config</span> <span class="o">=</span> <span class="n">TrainConfig</span><span class="p">(</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>    <span class="n">folder</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>    <span class="n">max_iter</span><span class="o">=</span><span class="n">n_epochs</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>    <span class="n">checkpoint_every</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>    <span class="n">write_every</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="n">data</span> <span class="o">=</span> <span class="n">to_dataloader</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">infinite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="n">train_with_grad</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">loss_fn</span><span class="o">=</span><span class="n">loss_fn</span><span class="p">)</span>
</code></pre></div>
<div class="result" markdown="1" >



</div></p>

            <details class="quote">
              <summary>Source code in <code>qadence/ml_tools/train_grad.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">model</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">dataloader</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">DictDataLoader</span><span class="p">],</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="n">optimizer</span><span class="p">:</span> <span class="n">Optimizer</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">config</span><span class="p">:</span> <span class="n">TrainConfig</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="n">loss_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">device</span><span class="p">:</span> <span class="n">torch_device</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">optimize_step</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">optimize_step</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">write_tensorboard</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">write_tensorboard</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">torch_dtype</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Module</span><span class="p">,</span> <span class="n">Optimizer</span><span class="p">]:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs the training loop with gradient-based optimizer.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    Assumes that `loss_fn` returns a tuple of (loss,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    metrics: dict), where `metrics` is a dict of scalars. Loss and metrics are</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    written to tensorboard. Checkpoints are written every</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    `config.checkpoint_every` steps (and after the last training step).  If a</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    checkpoint is found at `config.folder` we resume training from there.  The</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    tensorboard logs can be viewed via `tensorboard --logdir /path/to/folder`.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        model: The model to train.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        dataloader: dataloader of different types. If None, no data is required by</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">            the model</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        optimizer: The optimizer to use.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        config: `TrainConfig` with additional training options.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        loss_fn: Loss function returning (loss: float, metrics: dict[str, float])</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        device: String defining device to train on, pass &#39;cuda&#39; for GPU.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        optimize_step: Customizable optimization callback which is called at every iteration.=</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">            The function must have the signature `optimize_step(model,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            optimizer, loss_fn, xs, device=&quot;cpu&quot;)`.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        write_tensorboard: Customizable tensorboard logging callback which is</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            called every `config.write_every` iterations. The function must have</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            the signature `write_tensorboard(writer, loss, metrics, iteration)`</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            (see the example below).</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        dtype: The dtype to use for the data.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    ```python exec=&quot;on&quot; source=&quot;material-block&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    from pathlib import Path</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    import torch</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    from itertools import count</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    from qadence import Parameter, QuantumCircuit, Z</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    from qadence import hamiltonian_factory, hea, feature_map, chain</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    from qadence import QNN</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    from qadence.ml_tools import TrainConfig, train_with_grad, to_dataloader</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    n_qubits = 2</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    fm = feature_map(n_qubits)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    ansatz = hea(n_qubits=n_qubits, depth=3)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    observable = hamiltonian_factory(n_qubits, detuning = Z)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    circuit = QuantumCircuit(n_qubits, fm, ansatz)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    model = QNN(circuit, observable, backend=&quot;pyqtorch&quot;, diff_mode=&quot;ad&quot;)</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    batch_size = 1</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    input_values = {&quot;phi&quot;: torch.rand(batch_size, requires_grad=True)}</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    pred = model(input_values)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    ## lets prepare the train routine</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    cnt = count()</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    criterion = torch.nn.MSELoss()</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    optimizer = torch.optim.Adam(model.parameters(), lr=0.1)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    def loss_fn(model: torch.nn.Module, data: torch.Tensor) -&gt; tuple[torch.Tensor, dict]:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        next(cnt)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        x, y = data[0], data[1]</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        out = model(x)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        loss = criterion(out, y)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        return loss, {}</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    tmp_path = Path(&quot;/tmp&quot;)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    n_epochs = 5</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    batch_size = 25</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    config = TrainConfig(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        folder=tmp_path,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        max_iter=n_epochs,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        checkpoint_every=100,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        write_every=100,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    )</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    x = torch.linspace(0, 1, batch_size).reshape(-1, 1)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    y = torch.sin(x)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    data = to_dataloader(x, y, batch_size=batch_size, infinite=True)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    train_with_grad(model, data, optimizer, config, loss_fn=loss_fn)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    ```</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="c1"># load available checkpoint</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">init_iter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">init_iter</span> <span class="o">=</span> <span class="n">load_checkpoint</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded model and optimizer from </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="c1"># Move model to device before optimizer is loaded</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DataParallel</span><span class="p">):</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="c1"># initialize tensorboard</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">writer</span> <span class="o">=</span> <span class="n">SummaryWriter</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">purge_step</span><span class="o">=</span><span class="n">init_iter</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="n">perform_val</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">val_every</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">if</span> <span class="n">perform_val</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataloader</span><span class="p">,</span> <span class="n">DictDataLoader</span><span class="p">):</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>                <span class="s2">&quot;If `config.val_every` is provided as an integer, dataloader must&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>                <span class="s2">&quot;be an instance of `DictDataLoader`.&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">iter_keys</span> <span class="o">=</span> <span class="n">dataloader</span><span class="o">.</span><span class="n">dataloaders</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">if</span> <span class="s2">&quot;train&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">iter_keys</span> <span class="ow">or</span> <span class="s2">&quot;val&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">iter_keys</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                <span class="s2">&quot;If `config.val_every` is provided as an integer, the dictdataloader&quot;</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                <span class="s2">&quot;must have `train` and `val` keys to access the respective dataloaders.&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">val_dataloader</span> <span class="o">=</span> <span class="n">dataloader</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">dataloader</span> <span class="o">=</span> <span class="n">dataloader</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="c1">## Training</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="n">progress</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">TextColumn</span><span class="p">(</span><span class="s2">&quot;[progress.description]</span><span class="si">{task.description}</span><span class="s2">&quot;</span><span class="p">),</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">BarColumn</span><span class="p">(),</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">TaskProgressColumn</span><span class="p">(),</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">TimeRemainingColumn</span><span class="p">(</span><span class="n">elapsed_when_finished</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="n">data_dtype</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">if</span> <span class="n">dtype</span><span class="p">:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">data_dtype</span> <span class="o">=</span> <span class="n">float64</span> <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">complex128</span> <span class="k">else</span> <span class="n">float32</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="n">best_val_loss</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">with</span> <span class="n">progress</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="n">dl_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">dataloader</span><span class="p">)</span> <span class="k">if</span> <span class="n">dataloader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">if</span> <span class="n">perform_val</span><span class="p">:</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">dl_iter_val</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">val_dataloader</span><span class="p">)</span> <span class="k">if</span> <span class="n">val_dataloader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="c1"># outer epoch loop</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="n">progress</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">init_iter</span><span class="p">,</span> <span class="n">init_iter</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">max_iter</span><span class="p">)):</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="c1"># in case there is not data needed by the model</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="c1"># this is the case, for example, of quantum models</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="c1"># which do not have classical input data (e.g. chemistry)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="k">if</span> <span class="n">dataloader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                    <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">optimize_step</span><span class="p">(</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                        <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                        <span class="n">loss_fn</span><span class="o">=</span><span class="n">loss_fn</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                        <span class="n">xs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                        <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                        <span class="n">dtype</span><span class="o">=</span><span class="n">data_dtype</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                    <span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                    <span class="n">loss</span> <span class="o">=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataloader</span><span class="p">,</span> <span class="p">(</span><span class="n">DictDataLoader</span><span class="p">,</span> <span class="n">DataLoader</span><span class="p">)):</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>                    <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">optimize_step</span><span class="p">(</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>                        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                        <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                        <span class="n">loss_fn</span><span class="o">=</span><span class="n">loss_fn</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                        <span class="n">xs</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">dl_iter</span><span class="p">),</span>  <span class="c1"># type: ignore[arg-type]</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>                        <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                        <span class="n">dtype</span><span class="o">=</span><span class="n">data_dtype</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                    <span class="p">)</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                        <span class="sa">f</span><span class="s2">&quot;Unsupported dataloader type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataloader</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>                        <span class="s2">&quot;You can use e.g. `qadence.ml_tools.to_dataloader` to build a dataloader.&quot;</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                    <span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                <span class="k">if</span> <span class="n">iteration</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">print_every</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                    <span class="n">print_metrics</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                <span class="k">if</span> <span class="n">iteration</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">write_every</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                    <span class="n">write_tensorboard</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>                <span class="k">if</span> <span class="n">perform_val</span><span class="p">:</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                    <span class="k">if</span> <span class="n">iteration</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">val_every</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                        <span class="n">xs</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">dl_iter_val</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                        <span class="n">xs_to_device</span> <span class="o">=</span> <span class="n">data_to_device</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data_dtype</span><span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                        <span class="n">val_loss</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">xs_to_device</span><span class="p">)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">validation_criterion</span><span class="p">(</span><span class="n">val_loss</span><span class="p">,</span> <span class="n">best_val_loss</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">val_epsilon</span><span class="p">):</span>  <span class="c1"># type: ignore[misc]</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                            <span class="n">best_val_loss</span> <span class="o">=</span> <span class="n">val_loss</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">folder</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">checkpoint_best_only</span><span class="p">:</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                                <span class="n">write_checkpoint</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">iteration</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                            <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;val_loss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_loss</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                            <span class="n">write_tensorboard</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                    <span class="k">if</span> <span class="n">iteration</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">checkpoint_every</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">checkpoint_best_only</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                        <span class="n">write_checkpoint</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Terminating training gracefully after the current iteration.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="k">break</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="c1"># Final writing and checkpointing</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">folder</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">checkpoint_best_only</span><span class="p">:</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="n">write_checkpoint</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="n">write_tensorboard</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="qadence.ml_tools.train_no_grad.train" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataloader</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">loss_fn</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Runs the training loop with a gradient-free optimizer.</p>
<p>Assumes that <code>loss_fn</code> returns a tuple of (loss, metrics: dict), where
<code>metrics</code> is a dict of scalars. Loss and metrics are written to
tensorboard. Checkpoints are written every <code>config.checkpoint_every</code> steps
(and after the last training step).  If a checkpoint is found at <code>config.folder</code>
we resume training from there.  The tensorboard logs can be viewed via
<code>tensorboard --logdir /path/to/folder</code>.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>model</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The model to train</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.nn.Module">Module</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dataloader</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dataloader constructed via <code>dictdataloader</code></p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="qadence.ml_tools.data.DictDataLoader" href="#qadence.ml_tools.data.DictDataLoader">DictDataLoader</a> | <span title="torch.utils.data.DataLoader">DataLoader</span> | None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>optimizer</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The optimizer to use taken from the Nevergrad library. If this is not
the case the function will raise an AssertionError</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="nevergrad.optimization.base.Optimizer">Optimizer</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>loss_fn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loss function returning (loss: float, metrics: dict[str, float])</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Callable">Callable</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>qadence/ml_tools/train_no_grad.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">model</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">dataloader</span><span class="p">:</span> <span class="n">DictDataLoader</span> <span class="o">|</span> <span class="n">DataLoader</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">optimizer</span><span class="p">:</span> <span class="n">NGOptimizer</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="n">config</span><span class="p">:</span> <span class="n">TrainConfig</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">loss_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Module</span><span class="p">,</span> <span class="n">NGOptimizer</span><span class="p">]:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs the training loop with a gradient-free optimizer.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Assumes that `loss_fn` returns a tuple of (loss, metrics: dict), where</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    `metrics` is a dict of scalars. Loss and metrics are written to</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    tensorboard. Checkpoints are written every `config.checkpoint_every` steps</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    (and after the last training step).  If a checkpoint is found at `config.folder`</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    we resume training from there.  The tensorboard logs can be viewed via</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    `tensorboard --logdir /path/to/folder`.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        model: The model to train</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        dataloader: Dataloader constructed via `dictdataloader`</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        optimizer: The optimizer to use taken from the Nevergrad library. If this is not</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">            the case the function will raise an AssertionError</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        loss_fn: Loss function returning (loss: float, metrics: dict[str, float])</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">init_iter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">init_iter</span> <span class="o">=</span> <span class="n">load_checkpoint</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded model and optimizer from </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="k">def</span> <span class="nf">_update_parameters</span><span class="p">(</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ng_params</span><span class="p">:</span> <span class="n">ng</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">Array</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ng</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">Array</span><span class="p">]:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>  <span class="c1"># type: ignore[misc]</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">tell</span><span class="p">(</span><span class="n">ng_params</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">loss</span><span class="p">))</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="n">ng_params</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">ask</span><span class="p">()</span>  <span class="c1"># type: ignore [assignment]</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">promote_to_tensor</span><span class="p">(</span><span class="n">ng_params</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="n">set_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">ng_params</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">assert</span> <span class="n">loss_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Provide a valid loss function&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="c1"># TODO: support also Scipy optimizers</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">NGOptimizer</span><span class="p">),</span> <span class="s2">&quot;Use only optimizers from the Nevergrad library&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="c1"># initialize tensorboard</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">writer</span> <span class="o">=</span> <span class="n">SummaryWriter</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">purge_step</span><span class="o">=</span><span class="n">init_iter</span><span class="p">)</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="c1"># set optimizer configuration and initial parameters</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">budget</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">max_iter</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">enable_pickling</span><span class="p">()</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="c1"># TODO: Make it GPU compatible if possible</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">params</span> <span class="o">=</span> <span class="n">get_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="n">ng_params</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="c1"># serial training</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="c1"># TODO: Add a parallelization using the num_workers argument in Nevergrad</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">progress</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">TextColumn</span><span class="p">(</span><span class="s2">&quot;[progress.description]</span><span class="si">{task.description}</span><span class="s2">&quot;</span><span class="p">),</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">BarColumn</span><span class="p">(),</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="n">TaskProgressColumn</span><span class="p">(),</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="n">TimeRemainingColumn</span><span class="p">(</span><span class="n">elapsed_when_finished</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">with</span> <span class="n">progress</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="n">dl_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">dataloader</span><span class="p">)</span> <span class="k">if</span> <span class="n">dataloader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="n">progress</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">init_iter</span><span class="p">,</span> <span class="n">init_iter</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">max_iter</span><span class="p">)):</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="k">if</span> <span class="n">dataloader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>                <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">ng_params</span> <span class="o">=</span> <span class="n">_update_parameters</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ng_params</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataloader</span><span class="p">,</span> <span class="p">(</span><span class="n">DictDataLoader</span><span class="p">,</span> <span class="n">DataLoader</span><span class="p">)):</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>                <span class="n">data</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">dl_iter</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">ng_params</span> <span class="o">=</span> <span class="n">_update_parameters</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ng_params</span><span class="p">)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Unsupported dataloader type!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="k">if</span> <span class="n">iteration</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">print_every</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>                <span class="n">print_metrics</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="k">if</span> <span class="n">iteration</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">write_every</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>                <span class="n">write_tensorboard</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>                <span class="k">if</span> <span class="n">iteration</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">checkpoint_every</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                    <span class="n">write_checkpoint</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="k">if</span> <span class="n">iteration</span> <span class="o">&gt;=</span> <span class="n">init_iter</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">max_iter</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>                <span class="k">break</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="c1">## Final writing and stuff</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">write_checkpoint</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">write_tensorboard</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="qadence.ml_tools.data.DictDataLoader" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">DictDataLoader</span><span class="p">(</span><span class="n">dataloaders</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">


      <p>This class only holds a dictionary of <code>DataLoader</code>s and samples from them.</p>




  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="qadence.ml_tools.data.InfiniteTensorDataset" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">InfiniteTensorDataset</span><span class="p">(</span><span class="o">*</span><span class="n">tensors</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.utils.data.IterableDataset">IterableDataset</span></code></p>


      <p>Randomly sample points from the first dimension of the given tensors.</p>
<p>Behaves like a normal torch <code>Dataset</code> just that we can sample from it as
many times as we want.</p>
<p>Examples:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span> <span class="nn">torch</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">qadence.ml_tools.data</span> <span class="kn">import</span> <span class="n">InfiniteTensorDataset</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1"># The dataset accepts any number of tensors with the same batch dimension</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">ds</span> <span class="o">=</span> <span class="n">InfiniteTensorDataset</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1"># call `next` to get one sample from each tensor:</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">xs</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">ds</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="err">(</span><span class="kc">tens</span><span class="err">or(</span><span class="p">[</span><span class="mf">0.0510</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2603</span><span class="p">]</span><span class="err">)</span><span class="p">,</span><span class="w"> </span><span class="kc">tens</span><span class="err">or(</span><span class="p">[</span><span class="mf">1.</span><span class="p">]</span><span class="err">))</span>
</code></pre></div></p>

                  <details class="quote">
                    <summary>Source code in <code>qadence/ml_tools/data.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">tensors</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly sample points from the first dimension of the given tensors.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Behaves like a normal torch `Dataset` just that we can sample from it as</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    many times as we want.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    ```python exec=&quot;on&quot; source=&quot;above&quot; result=&quot;json&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    import torch</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    from qadence.ml_tools.data import InfiniteTensorDataset</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    x_data, y_data = torch.rand(5,2), torch.ones(5,1)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    # The dataset accepts any number of tensors with the same batch dimension</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    ds = InfiniteTensorDataset(x_data, y_data)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    # call `next` to get one sample from each tensor:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    xs = next(iter(ds))</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    print(str(xs)) # markdown-exec: hide</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    ```</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">tensors</span> <span class="o">=</span> <span class="n">tensors</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="qadence.ml_tools.data.data_to_device" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">data_to_device</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Utility method to move arbitrary data to 'device'.</p>

            <details class="quote">
              <summary>Source code in <code>qadence/ml_tools/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="nd">@singledispatch</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="k">def</span> <span class="nf">data_to_device</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Utility method to move arbitrary data to &#39;device&#39;.&quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to move </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span><span class="si">}</span><span class="s2"> with input args: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2"> and kwargs: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="qadence.ml_tools.data.to_dataloader" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dataloader</span><span class="p">(</span><span class="o">*</span><span class="n">tensors</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">infinite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Convert torch tensors an (infinite) Dataloader.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>*tensors</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Torch tensors to use in the dataloader.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.Tensor">Tensor</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>()</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>batch_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>batch size of sampled tensors</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>infinite</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>if <code>True</code>, the dataloader will keep sampling indefinitely even after the whole
dataset was sampled once</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Examples:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span> <span class="nn">torch</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">qadence.ml_tools</span> <span class="kn">import</span> <span class="n">to_dataloader</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">loader</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">to_dataloader</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">infinite</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">loader</span><span class="p">))</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">loader</span><span class="p">))</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">loader</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="p">[</span><span class="kc">tens</span><span class="err">or(</span><span class="p">[</span><span class="mf">0.8121</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2344</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8127</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4086</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6723</span><span class="p">]</span><span class="err">)</span><span class="p">,</span><span class="w"> </span><span class="kc">tens</span><span class="err">or(</span><span class="p">[</span><span class="mf">0.0024</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1447</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0733</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5337</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0236</span><span class="p">]</span><span class="err">)</span><span class="p">,</span><span class="w"> </span><span class="kc">tens</span><span class="err">or(</span><span class="p">[</span><span class="mf">0.2996</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2469</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4392</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4037</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7521</span><span class="p">]</span><span class="err">)</span><span class="p">]</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="p">[</span><span class="kc">tens</span><span class="err">or(</span><span class="p">[</span><span class="mf">0.0108</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1451</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1266</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5055</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1085</span><span class="p">]</span><span class="err">)</span><span class="p">,</span><span class="w"> </span><span class="kc">tens</span><span class="err">or(</span><span class="p">[</span><span class="mf">0.4551</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3460</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4155</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2224</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0021</span><span class="p">]</span><span class="err">)</span><span class="p">,</span><span class="w"> </span><span class="kc">tens</span><span class="err">or(</span><span class="p">[</span><span class="mf">0.5922</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5063</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4844</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5859</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5797</span><span class="p">]</span><span class="err">)</span><span class="p">]</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="p">[</span><span class="kc">tens</span><span class="err">or(</span><span class="p">[</span><span class="mf">0.8121</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2344</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8127</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4086</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6723</span><span class="p">]</span><span class="err">)</span><span class="p">,</span><span class="w"> </span><span class="kc">tens</span><span class="err">or(</span><span class="p">[</span><span class="mf">0.0024</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1447</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0733</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5337</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0236</span><span class="p">]</span><span class="err">)</span><span class="p">,</span><span class="w"> </span><span class="kc">tens</span><span class="err">or(</span><span class="p">[</span><span class="mf">0.2996</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2469</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4392</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4037</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7521</span><span class="p">]</span><span class="err">)</span><span class="p">]</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>qadence/ml_tools/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span> <span class="nf">to_dataloader</span><span class="p">(</span><span class="o">*</span><span class="n">tensors</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">infinite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataLoader</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert torch tensors an (infinite) Dataloader.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        *tensors: Torch tensors to use in the dataloader.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        batch_size: batch size of sampled tensors</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        infinite: if `True`, the dataloader will keep sampling indefinitely even after the whole</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            dataset was sampled once</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    ```python exec=&quot;on&quot; source=&quot;above&quot; result=&quot;json&quot;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    import torch</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    from qadence.ml_tools import to_dataloader</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    (x, y, z) = [torch.rand(10) for _ in range(3)]</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    loader = iter(to_dataloader(x, y, z, batch_size=5, infinite=True))</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    print(next(loader))</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    print(next(loader))</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    print(next(loader))</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    ```</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">InfiniteTensorDataset</span><span class="p">(</span><span class="o">*</span><span class="n">tensors</span><span class="p">)</span> <span class="k">if</span> <span class="n">infinite</span> <span class="k">else</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="o">*</span><span class="n">tensors</span><span class="p">)</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="k">return</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="qadence.ml_tools.models.QNN" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">QNN</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">observable</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">BackendName</span><span class="o">.</span><span class="n">PYQTORCH</span><span class="p">,</span> <span class="n">diff_mode</span><span class="o">=</span><span class="n">DiffMode</span><span class="o">.</span><span class="n">AD</span><span class="p">,</span> <span class="n">measurement</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">configuration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_diff_mode</span><span class="o">=</span><span class="n">InputDiffMode</span><span class="o">.</span><span class="n">AD</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="qadence.model.QuantumModel" href="../models/#qadence.model.QuantumModel">QuantumModel</a></code></p>


      <p>Quantum neural network model for n-dimensional inputs.</p>
<p>Examples:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span> <span class="nn">torch</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">qadence</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">QNN</span><span class="p">,</span> <span class="n">Z</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span> <span class="nn">qadence</span> <span class="kn">import</span> <span class="n">hea</span><span class="p">,</span> <span class="n">feature_map</span><span class="p">,</span> <span class="n">hamiltonian_factory</span><span class="p">,</span> <span class="n">kron</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1"># create the circuit</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">n_qubits</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="n">fm</span> <span class="o">=</span> <span class="n">kron</span><span class="p">(</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">feature_map</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">support</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">param</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">),</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">feature_map</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">support</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">param</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="p">)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">ansatz</span> <span class="o">=</span> <span class="n">hea</span><span class="p">(</span><span class="n">n_qubits</span><span class="o">=</span><span class="n">n_qubits</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">,</span> <span class="n">fm</span><span class="p">,</span> <span class="n">ansatz</span><span class="p">)</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">obs_base</span> <span class="o">=</span> <span class="n">hamiltonian_factory</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">,</span> <span class="n">detuning</span><span class="o">=</span><span class="n">Z</span><span class="p">)</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="c1"># the QNN will yield two outputs</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="n">obs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">obs_base</span><span class="p">,</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">obs_base</span><span class="p">]</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="c1"># initialize and use the model</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="n">qnn</span> <span class="o">=</span> <span class="n">QNN</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="n">y</span> <span class="o">=</span> <span class="n">qnn</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</code></pre></div>
<div class="result" markdown="1" >

<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kc">tens</span><span class="err">or(</span><span class="p">[[</span><span class="mf">0.0398</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0797</span><span class="p">],</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">        </span><span class="p">[</span><span class="mf">0.5731</span><span class="p">,</span><span class="w"> </span><span class="mf">1.1463</span><span class="p">],</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">        </span><span class="p">[</span><span class="mf">0.6757</span><span class="p">,</span><span class="w"> </span><span class="mf">1.3513</span><span class="p">]],</span><span class="w"> </span><span class="err">grad_</span><span class="kc">fn</span><span class="err">=&lt;Ca</span><span class="kc">t</span><span class="err">Backward</span><span class="mi">0</span><span class="err">&gt;)</span>
</code></pre></div>

</div></p>

      <p>Initialize the QNN.</p>
<p>The number of inputs is determined by the feature parameters in the input
quantum circuit while the number of outputs is determined by how many
observables are provided as input</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>circuit</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The quantum circuit to use for the QNN.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="qadence.circuit.QuantumCircuit" href="../quantumcircuit/#qadence.circuit.QuantumCircuit">QuantumCircuit</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>observable</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The observable.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>list[<a class="autorefs autorefs-internal" title="qadence.blocks.abstract.AbstractBlock" href="../blocks/#qadence.blocks.abstract.AbstractBlock">AbstractBlock</a>] | <a class="autorefs autorefs-internal" title="qadence.blocks.abstract.AbstractBlock" href="../blocks/#qadence.blocks.abstract.AbstractBlock">AbstractBlock</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>backend</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The chosen quantum backend.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="qadence.types.BackendName">BackendName</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="qadence.types.BackendName.PYQTORCH">PYQTORCH</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>diff_mode</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The differentiation engine to use. Choices 'gpsr' or 'ad'.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="qadence.types.DiffMode">DiffMode</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="qadence.types.DiffMode.AD">AD</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>measurement</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>optional measurement protocol. If None,
use exact expectation value with a statevector simulator</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="qadence.measurements.Measurements">Measurements</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>noise</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A noise model to use.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="qadence.noise.Noise">Noise</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>configuration</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>optional configuration for the backend</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="qadence.backend.BackendConfiguration" href="../backends/backend/#qadence.backend.BackendConfiguration">BackendConfiguration</a> | dict | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>inputs</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List that indicates the order of variables of the tensors that are passed
to the model. Given input tensors <code>xs = torch.rand(batch_size, input_size:=2)</code> a QNN
with <code>inputs=["t", "x"]</code> will assign <code>t, x = xs[:,0], xs[:,1]</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>list[<span title="sympy.Basic">Basic</span> | str] | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>input_diff_mode</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The differentiation mode for the input tensor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="qadence.types.InputDiffMode" href="../types/#qadence.types.InputDiffMode">InputDiffMode</a> | str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><a class="autorefs autorefs-internal" title="qadence.types.InputDiffMode.AD" href="../types/#qadence.types.InputDiffMode.AD">AD</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

                  <details class="quote">
                    <summary>Source code in <code>qadence/ml_tools/models.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="n">circuit</span><span class="p">:</span> <span class="n">QuantumCircuit</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">observable</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AbstractBlock</span><span class="p">]</span> <span class="o">|</span> <span class="n">AbstractBlock</span><span class="p">,</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">backend</span><span class="p">:</span> <span class="n">BackendName</span> <span class="o">=</span> <span class="n">BackendName</span><span class="o">.</span><span class="n">PYQTORCH</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">diff_mode</span><span class="p">:</span> <span class="n">DiffMode</span> <span class="o">=</span> <span class="n">DiffMode</span><span class="o">.</span><span class="n">AD</span><span class="p">,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="n">measurement</span><span class="p">:</span> <span class="n">Measurements</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="n">noise</span><span class="p">:</span> <span class="n">Noise</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="n">configuration</span><span class="p">:</span> <span class="n">BackendConfiguration</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="n">inputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">sympy</span><span class="o">.</span><span class="n">Basic</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="n">input_diff_mode</span><span class="p">:</span> <span class="n">InputDiffMode</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">InputDiffMode</span><span class="o">.</span><span class="n">AD</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="p">):</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the QNN.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    The number of inputs is determined by the feature parameters in the input</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    quantum circuit while the number of outputs is determined by how many</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    observables are provided as input</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        circuit: The quantum circuit to use for the QNN.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        observable: The observable.</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        backend: The chosen quantum backend.</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        diff_mode: The differentiation engine to use. Choices &#39;gpsr&#39; or &#39;ad&#39;.</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        measurement: optional measurement protocol. If None,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">            use exact expectation value with a statevector simulator</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        noise: A noise model to use.</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        configuration: optional configuration for the backend</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        inputs: List that indicates the order of variables of the tensors that are passed</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">            to the model. Given input tensors `xs = torch.rand(batch_size, input_size:=2)` a QNN</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">            with `inputs=[&quot;t&quot;, &quot;x&quot;]` will assign `t, x = xs[:,0], xs[:,1]`.</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        input_diff_mode: The differentiation mode for the input tensor.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="n">circuit</span><span class="p">,</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="n">observable</span><span class="o">=</span><span class="n">observable</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">diff_mode</span><span class="o">=</span><span class="n">diff_mode</span><span class="p">,</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="n">measurement</span><span class="o">=</span><span class="n">measurement</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">configuration</span><span class="o">=</span><span class="n">configuration</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You need to provide at least one observable in the QNN constructor&quot;</span><span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">inputs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)):</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">]</span>  <span class="c1"># type: ignore[union-attr]</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="k">elif</span> <span class="p">(</span><span class="n">inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]</span>  <span class="c1"># type: ignore[union-attr]</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">            Your QNN has more than one input. Please provide a list of inputs in the order of</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">            your tensor domain. For example, if you want to pass</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">            `xs = torch.rand(batch_size, input_size:=3)` to you QNN, where</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">            ```</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">            t = x[:,0]</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">            x = x[:,1]</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">            y = x[:,2]</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">            ```</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">            you have to specify</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">            ```</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">            QNN(circuit, observable, inputs=[&quot;t&quot;, &quot;x&quot;, &quot;y&quot;])</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">            ```</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">            You can also pass a list of sympy symbols.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">format_to_dict</span> <span class="o">=</span> <span class="n">format_to_dict_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">input_diff_mode</span> <span class="o">=</span> <span class="n">InputDiffMode</span><span class="p">(</span><span class="n">input_diff_mode</span><span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff_mode</span> <span class="o">==</span> <span class="n">InputDiffMode</span><span class="o">.</span><span class="n">FD</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="kn">from</span> <span class="nn">qadence.backends.utils</span> <span class="kn">import</span> <span class="n">finitediff</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__derivative</span> <span class="o">=</span> <span class="n">finitediff</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_diff_mode</span> <span class="o">==</span> <span class="n">InputDiffMode</span><span class="o">.</span><span class="n">AD</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__derivative</span> <span class="o">=</span> <span class="n">_torch_derivative</span>  <span class="c1"># type: ignore[assignment]</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unkown forward diff mode: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_diff_mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="qadence.ml_tools.models.QNN.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">measurement</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endianness</span><span class="o">=</span><span class="n">Endianness</span><span class="o">.</span><span class="n">BIG</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Forward pass of the model.</p>
<p>This returns the (differentiable) expectation value of the given observable
operator defined in the constructor. Differently from the base QuantumModel
class, the QNN accepts also a tensor as input for the forward pass. The
tensor is expected to have shape: <code>n_batches x in_features</code> where <code>n_batches</code>
is the number of data points and <code>in_features</code> is the dimensionality of the problem</p>
<p>The output of the forward pass is the expectation value of the input
observable(s). If a single observable is given, the output shape is
<code>n_batches</code> while if multiple observables are given the output shape
is instead <code>n_batches x n_observables</code></p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>values</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the values of the feature parameters</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict[str, <span title="torch.Tensor">Tensor</span>] | <span title="torch.Tensor">Tensor</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>state</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Initial state.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.Tensor">Tensor</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>measurement</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>optional measurement protocol. If None,
use exact expectation value with a statevector simulator</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="qadence.measurements.Measurements">Measurements</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>noise</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A noise model to use.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="qadence.noise.Noise">Noise</span> | None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>endianness</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Endianness of the resulting bit strings.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="qadence.types.Endianness" href="../types/#qadence.types.Endianness">Endianness</a></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><a class="autorefs autorefs-internal" title="qadence.types.Endianness.BIG" href="../types/#qadence.types.Endianness.BIG">BIG</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>Tensor</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a tensor with the expectation value of the observables passed
in the constructor of the model</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.Tensor">Tensor</span></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>qadence/ml_tools/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]</span> <span class="o">|</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="n">state</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="n">measurement</span><span class="p">:</span> <span class="n">Measurements</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="n">noise</span><span class="p">:</span> <span class="n">Noise</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="n">endianness</span><span class="p">:</span> <span class="n">Endianness</span> <span class="o">=</span> <span class="n">Endianness</span><span class="o">.</span><span class="n">BIG</span><span class="p">,</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Forward pass of the model.</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">    This returns the (differentiable) expectation value of the given observable</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    operator defined in the constructor. Differently from the base QuantumModel</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">    class, the QNN accepts also a tensor as input for the forward pass. The</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">    tensor is expected to have shape: `n_batches x in_features` where `n_batches`</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">    is the number of data points and `in_features` is the dimensionality of the problem</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">    The output of the forward pass is the expectation value of the input</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    observable(s). If a single observable is given, the output shape is</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">    `n_batches` while if multiple observables are given the output shape</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">    is instead `n_batches x n_observables`</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        values: the values of the feature parameters</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        state: Initial state.</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">        measurement: optional measurement protocol. If None,</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">            use exact expectation value with a statevector simulator</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">        noise: A noise model to use.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">        endianness: Endianness of the resulting bit strings.</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">        Tensor: a tensor with the expectation value of the observables passed</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">            in the constructor of the model</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expectation</span><span class="p">(</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="n">values</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">measurement</span><span class="o">=</span><span class="n">measurement</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span> <span class="n">endianness</span><span class="o">=</span><span class="n">endianness</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qadence.ml_tools.models.QNN.from_configs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_configs</span><span class="p">(</span><span class="n">register</span><span class="p">,</span> <span class="n">fm_config</span><span class="p">,</span> <span class="n">ansatz_config</span><span class="p">,</span> <span class="n">obs_config</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

      <p>Create a QNN from a set of configurations.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>register</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The number of qubits or a register object.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int | <a class="autorefs autorefs-internal" title="qadence.register.Register" href="../register/#qadence.register.Register">Register</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fm_config</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The configuration for the feature map.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Any">Any</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ansatz_config</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The configuration for the ansatz.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Any">Any</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>obs_config</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The configuration for the observable.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Any">Any</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="qadence.ml_tools.models.QNN" href="#qadence.ml_tools.models.QNN">QNN</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A QNN object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span> <span class="nn">torch</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">qadence.ml_tools.config</span> <span class="kn">import</span> <span class="n">AnsatzConfig</span><span class="p">,</span> <span class="n">FeatureMapConfig</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span> <span class="nn">qadence.ml_tools</span> <span class="kn">import</span> <span class="n">QNN</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span> <span class="nn">qadence.constructors</span> <span class="kn">import</span> <span class="n">ObservableConfig</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">from</span> <span class="nn">qadence.operations</span> <span class="kn">import</span> <span class="n">Z</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="kn">from</span> <span class="nn">qadence.types</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">AnsatzType</span><span class="p">,</span> <span class="n">BasisSet</span><span class="p">,</span> <span class="n">ReuploadScaling</span><span class="p">,</span> <span class="n">ObservableTransform</span><span class="p">,</span> <span class="n">Strategy</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="n">register</span> <span class="o">=</span> <span class="mi">4</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">fm_config</span> <span class="o">=</span> <span class="n">FeatureMapConfig</span><span class="p">(</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">num_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">],</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="n">basis_set</span><span class="o">=</span><span class="n">BasisSet</span><span class="o">.</span><span class="n">FOURIER</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="n">reupload_scaling</span><span class="o">=</span><span class="n">ReuploadScaling</span><span class="o">.</span><span class="n">CONSTANT</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">feature_range</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="p">},</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="p">)</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="n">ansatz_config</span> <span class="o">=</span> <span class="n">AnsatzConfig</span><span class="p">(</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    <span class="n">ansatz_type</span><span class="o">=</span><span class="n">AnsatzType</span><span class="o">.</span><span class="n">HEA</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>    <span class="n">ansatz_strategy</span><span class="o">=</span><span class="n">Strategy</span><span class="o">.</span><span class="n">DIGITAL</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="p">)</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="n">obs_config</span> <span class="o">=</span> <span class="n">ObservableConfig</span><span class="p">(</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>    <span class="n">detuning</span><span class="o">=</span><span class="n">Z</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>    <span class="n">scale</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="n">shift</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>    <span class="n">transformation_type</span><span class="o">=</span><span class="n">ObservableTransform</span><span class="o">.</span><span class="n">SCALE</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    <span class="n">trainable_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="p">)</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="n">qnn</span> <span class="o">=</span> <span class="n">QNN</span><span class="o">.</span><span class="n">from_configs</span><span class="p">(</span><span class="n">register</span><span class="p">,</span> <span class="n">fm_config</span><span class="p">,</span> <span class="n">ansatz_config</span><span class="p">,</span> <span class="n">obs_config</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="n">y</span> <span class="o">=</span> <span class="n">qnn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div>
<div class="result" markdown="1" >

<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kc">tens</span><span class="err">or(</span><span class="p">[[</span><span class="mf">-3.9095</span><span class="p">],</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="mf">1.2654</span><span class="p">]],</span><span class="w"> </span><span class="err">grad_</span><span class="kc">fn</span><span class="err">=&lt;Ca</span><span class="kc">t</span><span class="err">Backward</span><span class="mi">0</span><span class="err">&gt;)</span>
</code></pre></div>

</div></p>

            <details class="quote">
              <summary>Source code in <code>qadence/ml_tools/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="k">def</span> <span class="nf">from_configs</span><span class="p">(</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="bp">cls</span><span class="p">,</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="n">register</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Register</span><span class="p">,</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="n">fm_config</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="n">ansatz_config</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="n">obs_config</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QNN</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a QNN from a set of configurations.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">        register: The number of qubits or a register object.</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">        fm_config: The configuration for the feature map.</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">        ansatz_config: The configuration for the ansatz.</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        obs_config: The configuration for the observable.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        A QNN object.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    ```python exec=&quot;on&quot; source=&quot;material-block&quot; result=&quot;json&quot;</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    import torch</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">    from qadence.ml_tools.config import AnsatzConfig, FeatureMapConfig</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    from qadence.ml_tools import QNN</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">    from qadence.constructors import ObservableConfig</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    from qadence.operations import Z</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    from qadence.types import (</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        AnsatzType, BasisSet, ReuploadScaling, ObservableTransform, Strategy</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    )</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    register = 4</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    fm_config = FeatureMapConfig(</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        num_features=2,</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        inputs=[&quot;x&quot;, &quot;y&quot;],</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        basis_set=BasisSet.FOURIER,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        reupload_scaling=ReuploadScaling.CONSTANT,</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        feature_range={</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">            &quot;x&quot;: (-1.0, 1.0),</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">            &quot;y&quot;: (0.0, 1.0),</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">        },</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    )</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    ansatz_config = AnsatzConfig(</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        depth=2,</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">        ansatz_type=AnsatzType.HEA,</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">        ansatz_strategy=Strategy.DIGITAL,</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">    )</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    obs_config = ObservableConfig(</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">        detuning=Z,</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">        scale=5.0,</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">        shift=0.0,</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">        transformation_type=ObservableTransform.SCALE,</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">        trainable_transform=None,</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">    )</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">    qnn = QNN.from_configs(register, fm_config, ansatz_config, obs_config)</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">    x = torch.rand(2, 2)</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">    y = qnn(x)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">    print(str(y)) # markdown-exec: hide</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">    ```</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="kn">from</span> <span class="nn">.constructors</span> <span class="kn">import</span> <span class="n">build_qnn_from_configs</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="k">return</span> <span class="n">build_qnn_from_configs</span><span class="p">(</span><span class="n">register</span><span class="p">,</span> <span class="n">fm_config</span><span class="p">,</span> <span class="n">ansatz_config</span><span class="p">,</span> <span class="n">obs_config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="qadence.ml_tools.models.derivative" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">derivative</span><span class="p">(</span><span class="n">ufa</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">derivative_indices</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Compute derivatives w.r.t.</p>
<p>inputs of a UFA with a single output. The
<code>derivative_indices</code> specify which derivative(s) are computed.  E.g.
<code>derivative_indices=(1,2)</code> would compute the a second order derivative w.r.t
to the indices <code>1</code> and <code>2</code> of the input tensor.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>ufa</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The model for which we want to compute the derivative.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.nn.Module">Module</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>x</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>(batch_size, input_size) input tensor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="torch.Tensor">Tensor</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>derivative_indices</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Define which derivatives to compute.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Examples:
If we create a UFA with three inputs and denote the first, second, and third
input with <code>x</code>, <code>y</code>, and <code>z</code> we can compute the following derivatives w.r.t
to those inputs:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span> <span class="nn">torch</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">qadence.ml_tools.models</span> <span class="kn">import</span> <span class="n">derivative</span><span class="p">,</span> <span class="n">QNN</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span> <span class="nn">qadence.ml_tools.config</span> <span class="kn">import</span> <span class="n">FeatureMapConfig</span><span class="p">,</span> <span class="n">AnsatzConfig</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span> <span class="nn">qadence.constructors.hamiltonians</span> <span class="kn">import</span> <span class="n">ObservableConfig</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">from</span> <span class="nn">qadence.operations</span> <span class="kn">import</span> <span class="n">Z</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="n">fm_config</span> <span class="o">=</span> <span class="n">FeatureMapConfig</span><span class="p">(</span><span class="n">num_features</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">])</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="n">ansatz_config</span> <span class="o">=</span> <span class="n">AnsatzConfig</span><span class="p">()</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">obs_config</span> <span class="o">=</span> <span class="n">ObservableConfig</span><span class="p">(</span><span class="n">detuning</span><span class="o">=</span><span class="n">Z</span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">f</span> <span class="o">=</span> <span class="n">QNN</span><span class="o">.</span><span class="n">from_configs</span><span class="p">(</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">register</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fm_config</span><span class="o">=</span><span class="n">fm_config</span><span class="p">,</span> <span class="n">ansatz_config</span><span class="o">=</span><span class="n">ansatz_config</span><span class="p">,</span> <span class="n">obs_config</span><span class="o">=</span><span class="n">obs_config</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="p">)</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="n">inputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="c1"># df_dx</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="n">derivative</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="c1"># d2f_dydz</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="n">derivative</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="c1"># d3fdy2dx</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="n">derivative</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</code></pre></div>
<div class="result" markdown="1" >



</div></p>

            <details class="quote">
              <summary>Source code in <code>qadence/ml_tools/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="k">def</span> <span class="nf">derivative</span><span class="p">(</span><span class="n">ufa</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">derivative_indices</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute derivatives w.r.t.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    inputs of a UFA with a single output. The</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    `derivative_indices` specify which derivative(s) are computed.  E.g.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    `derivative_indices=(1,2)` would compute the a second order derivative w.r.t</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    to the indices `1` and `2` of the input tensor.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        ufa: The model for which we want to compute the derivative.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        x (Tensor): (batch_size, input_size) input tensor.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        derivative_indices (tuple): Define which derivatives to compute.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    If we create a UFA with three inputs and denote the first, second, and third</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    input with `x`, `y`, and `z` we can compute the following derivatives w.r.t</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    to those inputs:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    ```py exec=&quot;on&quot; source=&quot;material-block&quot;</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    import torch</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    from qadence.ml_tools.models import derivative, QNN</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    from qadence.ml_tools.config import FeatureMapConfig, AnsatzConfig</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    from qadence.constructors.hamiltonians import ObservableConfig</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    from qadence.operations import Z</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    fm_config = FeatureMapConfig(num_features=3, inputs=[&quot;x&quot;, &quot;y&quot;, &quot;z&quot;])</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    ansatz_config = AnsatzConfig()</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    obs_config = ObservableConfig(detuning=Z)</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    f = QNN.from_configs(</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        register=3, fm_config=fm_config, ansatz_config=ansatz_config, obs_config=obs_config</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    )</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    inputs = torch.rand(5,3,requires_grad=True)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    # df_dx</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    derivative(f, inputs, (0,))</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    # d2f_dydz</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    derivative(f, inputs, (1,2))</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    # d3fdy2dx</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    derivative(f, inputs, (1,1,0))</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    ```</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">assert</span> <span class="n">ufa</span><span class="o">.</span><span class="n">out_features</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Can only call `derivative` on models with 1D output.&quot;</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">return</span> <span class="n">ufa</span><span class="o">.</span><span class="n">_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">derivative_indices</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="qadence.ml_tools.models.format_to_dict_fn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">format_to_dict_fn</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[])</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Format an input tensor into the format required by the forward pass.</p>
<p>The tensor is assumed to have dimensions: n_batches x in_features where in_features
corresponds to the number of input features of the QNN</p>

            <details class="quote">
              <summary>Source code in <code>qadence/ml_tools/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="k">def</span> <span class="nf">format_to_dict_fn</span><span class="p">(</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="n">inputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Tensor</span> <span class="o">|</span> <span class="n">ParamDictType</span><span class="p">],</span> <span class="n">ParamDictType</span><span class="p">]:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Format an input tensor into the format required by the forward pass.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    The tensor is assumed to have dimensions: n_batches x in_features where in_features</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    corresponds to the number of input features of the QNN</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="n">in_features</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">def</span> <span class="nf">tensor_to_dict</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">|</span> <span class="n">ParamDictType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ParamDictType</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">size</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">values</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">in_features</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>                    <span class="sa">f</span><span class="s2">&quot;Model expects in_features=</span><span class="si">{</span><span class="n">in_features</span><span class="si">}</span><span class="s2"> but got </span><span class="si">{</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>                <span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">fparam</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">values</span><span class="p">[:,</span> <span class="n">inputs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">fparam</span><span class="p">)]</span> <span class="k">for</span> <span class="n">fparam</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">}</span>  <span class="c1"># type: ignore[union-attr]</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="k">return</span> <span class="n">values</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">return</span> <span class="n">tensor_to_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "navigation.tabs", "navigation.indexes", "navigation.sections", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
        <script src="../../assets/_markdown_exec_pyodide.js"></script>
      
        <script src="../../extras/javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>